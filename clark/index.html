<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Clark Street</title>
    <meta name="nyu-vr" content="Clark Street">
    <script src="../js/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
        <a-camera position="0 7 0" wasd-controls-enabled="false" cursor-opacity="0.6"></a-camera>

        <a-cylinder position="0 0 0" onclick="test();"
            radius="1" height="2.5" open-ended="false"
            color="#93648D" roughness="0.5" metalness="0.5">
        </a-cylinder>

        <a-sky src="../data/clark/479050310.432638.jpg" rotation="0 0 0"></a-sky>
        <a-image id="front" onclick="walk('front');" scale="3 3 3" position="0 0 -10" src="../data/arrow.png" opacity="0.3" rotation="90 180 0">
            <a-mouseenter opacity="0.7"></a-mouseenter>
            <a-mouseleave opacity="0.3"></a-mouseleave>
        </a-image>
        <a-image id="right" onclick="walk('right');" scale="3 3 3" position="10 0 0" src="../data/arrow.png" opacity="0.3" rotation="90 90 0">
            <a-mouseenter opacity="0.7"></a-mouseenter>
            <a-mouseleave opacity="0.3"></a-mouseleave>
        </a-image>
        <a-image id="back" onclick="walk('back');" scale="3 3 3" position="0 0 10" src="../data/arrow.png" opacity="0.3" rotation="90 0 0">
            <a-mouseenter opacity="0.7"></a-mouseenter>
            <a-mouseleave opacity="0.3"></a-mouseleave>
        </a-image>
        <a-image id="left" onclick="walk('left');" scale="3 3 3" position="-10 0 0" src="../data/arrow.png" opacity="0.3" rotation="90 -90 0">
            <a-mouseenter opacity="0.7"></a-mouseenter>
            <a-mouseleave opacity="0.3"></a-mouseleave>
        </a-image>
    </a-scene>

    <script>
        var map;
        var current = "479050310.432638";

        function loadJSON() {

            xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            xobj.open('GET', '../data/clark/map.json', true);
            xobj.onreadystatechange = function() {
                if (xobj.readyState == 4 && xobj.status == "200") {

                    // .open will NOT return a value but simply returns undefined in async mode so use a callback
                    map = JSON.parse(xobj.responseText);
                    walk("init");
                }
            }
            xobj.send(null);
        }

        // Call to function with anonymous callback
        loadJSON();

        function walk(direction) {
            if (direction != "init") {
                current = map[current][direction];
                document.getElementsByTagName("a-sky")[0].setAttribute("src","../data/clark/"+current+".jpg");
            }
            for (arrow in map[current]) {
                if (arrow != "rotate") {
                    if (map[current][arrow] == "null") {
                        document.getElementById(arrow).setAttribute("scale","0 0 0");
                    } else {
                        document.getElementById(arrow).setAttribute("scale","3 3 3");
                    }
                } else {
                    document.getElementsByTagName("a-sky")[0].setAttribute("rotation", "0 "+map[current][arrow]+" 0");
                }
            }
        }

    </script>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>55 Clark Street</title>
    <meta name="nyu-vr" content="Clark Street">
    <script src="../js/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
        <a-camera position="0 7 0" rotation="0 -90 0" wasd-controls-enabled="false" cursor-visible="false" cursor-opacity="0.6"></a-camera>

        <a-cylinder position="0 0 0" onclick="test();"
            radius="1" height="2.5" open-ended="false"
            color="#93648D" roughness="0.5" metalness="0.5">
        </a-cylinder>

        <a-sky src="../data/clark/479050310.432638.jpg" rotation="0 0 0"></a-sky>
        <a-cube id="arrow" scale="1 0.2 1" rotation="0 45 0" opacity="0">
            <a-animation id="arrowanimation" attribute="position"
                         from="0 0 -15"
                         to="0 0 -20"
                         dur="1000"
                         easing="linear"
                         repeat="indefinite"></a-animation>
        </a-cube>
        <a-cube id="front" onclick="walk('front');" scale="10 10 0" opacity="0" position="0 5 -10">
            <a-mouseenter target="#arrow" opacity="0.6"></a-mouseenter>
            <a-mouseenter target="#arrowanimation" from="0 0 -15" to="0 0 -20"></a-mouseenter>
            <a-mouseleave target="#arrow" opacity="0"></a-mouseleave>
        </a-cube>
        <a-cube id="right" onclick="walk('right');" scale="10 10 0" opacity="0" position="10 5 0" rotation="0 90 0">
            <a-mouseenter target="#arrow" opacity="0.6"></a-mouseenter>
            <a-mouseenter target="#arrowanimation" from="15 0 0" to="20 0 0"></a-mouseenter>
            <a-mouseleave target="#arrow" opacity="0"></a-mouseleave>
        </a-cube>
        <a-cube id="back" onclick="walk('back');" scale="10 10 0" opacity="0" position="0 5 10">
            <a-mouseenter target="#arrow" opacity="0.6"></a-mouseenter>
            <a-mouseenter target="#arrowanimation" from="0 0 15" to="0 0 20"></a-mouseenter>
            <a-mouseleave target="#arrow" opacity="0"></a-mouseleave>
        </a-cube>
        <a-cube id="left" onclick="walk('left');" scale="10 10 0" opacity="0" position="-10 5 0" rotation="0 90 0">
            <a-mouseenter target="#arrow" opacity="0.6"></a-mouseenter>
            <a-mouseenter target="#arrowanimation" from="-15 0 0" to="-20 0 0"></a-mouseenter>
            <a-mouseleave target="#arrow" opacity="0"></a-mouseleave>
        </a-cube>
    </a-scene>

    <script>
        var map;
        var current;

        
        function loadJSON() {

            xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            xobj.open('GET', '../data/clark/map.json', true);
            xobj.onreadystatechange = function() {
                if (xobj.readyState == 4 && xobj.status == "200") {

                    // .open will NOT return a value but simply returns undefined in async mode so use a callback
                    map = JSON.parse(xobj.responseText);
                    walk("init");
                }
            }
            xobj.send(null);
        }

        // Call to function with anonymous callback
        loadJSON();

        var mouseMoved = false;
        var mousedown = false;
        function walk(direction) {
            // handle drag without click
            document.querySelector('html').addEventListener('mousedown', function () {
                mousedown = true;
            });
            document.querySelector('html').addEventListener('mousemove', function () {
                if (mousedown) {
                    mouseMoved = true;
                } else {
                    mouseMoved = false;
                }
            });
            document.querySelector('html').addEventListener('mouseup', function () {
                window.setTimeout(function() {
                    mousedown = false;
                    mouseMoved = false;
                });
            });

            var info = window.location.search.substring(1).split("&");
            if (direction != "init") {
                if (!mouseMoved) {
                    current = map[current][direction];
                }
            } else {

                if (info[0]) {
                    current = info[0];
                } else {
                    current = "479053675.664591";
                }
                if (info[1]){
                    document.getElementsByTagName("a-camera")[0].setAttribute("rotation","0 "+info[1]+" 0");
                }
            }
            document.getElementsByTagName("a-sky")[0].setAttribute("src","../data/clark/"+current+".jpg");
            for (arrow in map[current]) {
                if (arrow != "rotate") {
                    if (map[current][arrow] == "null") {
                        document.getElementById(arrow).setAttribute("scale","0 0 0");
                    } else {
                        document.getElementById(arrow).setAttribute("scale","10 10 0");
                    }
                } else {
                    document.getElementsByTagName("a-sky")[0].setAttribute("rotation", "0 "+map[current][arrow]+" 0");
                }
            }
        }


    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59972581-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
